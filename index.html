<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Estimate Calculator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="/manifest.json">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
                    console.log('Service Worker registered with scope:', registration.scope);
                }, function(error) {
                    console.log('Service Worker registration failed:', error);
                });
            });
        }

        function handleCredentialResponse(response) {
            console.log("Encoded JWT ID token: " + response.credential);
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
        }

        window.onload = function () {
            google.accounts.id.initialize({
                client_id: "570167873669-2edb719fp17l9oof9qhik4kirnfad7lp.apps.googleusercontent.com",
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.getElementById("g_id_signin"),
                { theme: "outline", size: "large" }
            );
            google.accounts.id.prompt();
        };

        let totalPrice = 0;

        function calculateEstimate() {
            const height = parseFloat(document.getElementById('height').value);
            const radius1 = parseFloat(document.getElementById('radius1').value);
            const radius2 = parseFloat(document.getElementById('radius2').value);
            const canopyHeight = parseFloat(document.getElementById('canopyHeight').value);
            const density = parseInt(document.getElementById('density').value);
            const trimLevel = parseInt(document.getElementById('trimLevel').value);

            // BasicTrim Calculation
            const basicTrim = (height * 3) + (radius1 * 1.5) + (radius2 * 1.5) + (canopyHeight * 2);

            // Trim Level and Density Multipliers
            const multipliers = {
                1: { 1: 1.1, 2: 1.2, 3: 1.7, 4: 4.3 },
                2: { 1: 1.4, 2: 1.6, 3: 2.2, 4: 5.1 },
                3: { 1: 1.7, 2: 2.0, 3: 2.8, 4: 6.2 },
                4: { 1: 2.0, 2: 2.4, 3: 3.4, 4: 7.2 }
            };

            const multiplier = multipliers[density][trimLevel];
            const cost = basicTrim * multiplier;

            totalPrice = cost;

            document.getElementById('result').innerText = `Estimated Price: $${totalPrice.toFixed(2)}`;
            document.getElementById('downloadButton').style.display = 'block';
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Add the logo
            const img = new Image();
            img.src = 'https://github.com/wtPrice/wtPrice.github.io/assets/169125006/2905b6ed-5f97-4008-b574-ef07cadf024a';
            img.onload = function() {
                doc.addImage(img, 'PNG', 10, 10, 50, 50);

                // Set font and add title
                doc.setFontSize(20);
                doc.text('Tree Estimate Invoice', 105, 20, null, null, 'center');

                // Add some spacing
                doc.setFontSize(12);
                doc.text(' ', 10, 40);

                // Add estimate details
                let yPos = 60;
                const estimateDetails = [
                    { label: 'Height (ft):', value: document.getElementById('height').value },
                    { label: 'Canopy Radius 1 (ft):', value: document.getElementById('radius1').value },
                    { label: 'Canopy Radius 2 (ft):', value: document.getElementById('radius2').value },
                    { label: 'Canopy Height (ft):', value: document.getElementById('canopyHeight').value },
                    { label: 'Density Level:', value: document.getElementById('density').value },
                    { label: 'Trim Level:', value: document.getElementById('trimLevel').value }
                ];

                estimateDetails.forEach(detail => {
                    doc.text(`${detail.label} ${detail.value}`, 10, yPos);
                    yPos += 10;
                });

                // Add total price
                doc.setFontSize(16);
                doc.text(`Total Price: $${totalPrice.toFixed(2)}`, 10, yPos + 20);

                // Save the PDF
                doc.save('tree_estimate_invoice.pdf');
            };
        }

        function nextStep(currentStep) {
            document.getElementById(`step-${currentStep}`).style.display = 'none';
            document.getElementById(`step-${currentStep + 1}`).style.display = 'block';
            document.querySelector(`#step-${currentStep + 1} input, #step-${currentStep + 1} select`).focus();
        }

        function prevStep(currentStep) {
            document.getElementById(`step-${currentStep}`).style.display = 'none';
            document.getElementById(`step-${currentStep - 1}`).style.display = 'block';
            document.querySelector(`#step-${currentStep - 1} input, #step-${currentStep - 1} select`).focus();
        }

        document.getElementById('treeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateEstimate();
        });
    </script>
</head>
<body>
    <div id="auth-container">
        <h2>Please Sign In</h2>
        <div id="g_id_signin"></div>
    </div>
    
    <div class="container" id="app-container" style="display:none;">
        <header>
            <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/2905b6ed-5f97-4008-b574-ef07cadf024a" alt="WTPrice Logo" class="logo">
        </header>
        <h1>Tree Estimate Calculator</h1>
        <form id="treeForm">
            <div class="step" id="step-1">
                <div class="form-group">
                    <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/00a42bfe-3871-4e69-8941-9d597e885414" alt="Height Icon">
                    <label for="height">Height (ft):</label>
                    <input type="number" id="height" name="height">
                </div>
                <div class="button-group">
                    <button type="button" onclick="nextStep(1)">Next</button>
                </div>
            </div>
            
            <div class="step" id="step-2" style="display:none;">
                <div class="form-group">
                    <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/0d333c48-6335-4e11-b7f2-3dd9361a3da5" alt="Canopy Radius Icon">
                    <label for="radius1">Canopy Radius 1 (ft):</label>
                    <input type="number" id="radius1" name="radius1">
                </div>
                <div class="button-group">
                    <button type="button" onclick="prevStep(2)">Back</button>
                    <button type="button" onclick="nextStep(2)">Next</button>
                </div>
            </div>
            
            <div class="step" id="step-3" style="display:none;">
                <div class="form-group">
                    <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/0d333c48-6335-4e11-b7f2-3dd9361a3da5" alt="Canopy Radius Icon">
                    <label for="radius2">Canopy Radius 2 (ft):</label>
                    <input type="number" id="radius2" name="radius2">
                </div>
                <div class="button-group">
                    <button type="button" onclick="prevStep(3)">Back</button>
                    <button type="button" onclick="
nextStep(3)">Next</button>
                </div>
            </div>
            
            <div class="step" id="step-4" style="display:none;">
                <div class="form-group">
                    <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/ed02364d-ebe8-410d-a0d6-71ade7bcfd78" alt="Canopy Height Icon">
                    <label for="canopyHeight">Canopy Height (ft):</label>
                    <input type="number" id="canopyHeight" name="canopyHeight">
                </div>
                <div class="button-group">
                    <button type="button" onclick="prevStep(4)">Back</button>
                    <button type="button" onclick="nextStep(4)">Next</button>
                </div>
            </div>
            
            <div class="step" id="step-5" style="display:none;">
                <div class="form-group">
                    <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/7483349e-7af2-4a9e-bae6-d60b67a0c797" alt="Density Icon">
                    <label for="density">Density Level:</label>
                    <select id="density" name="density">
                        <option value="1">1 - Sparse</option>
                        <option value="2">2 - Medium</option>
                        <option value="3">3 - Dense</option>
                        <option value="4">4 - Very Dense</option>
                    </select>
                </div>
                <div class="button-group">
                    <button type="button" onclick="prevStep(5)">Back</button>
                    <button type="button" onclick="nextStep(5)">Next</button>
                </div>
            </div>
            
            <div class="step" id="step-6" style="display:none;">
                <div class="form-group">
                    <img src="https://github.com/wtPrice/wtPrice.github.io/assets/169125006/c07bfe29-a412-421f-be88-047b53f51a06" alt="Trim Level Icon">
                    <label for="trimLevel">Trim Level:</label>
                    <select id="trimLevel" name="trimLevel">
                        <option value="1">1 - Basic Trim</option>
                        <option value="2">2 - Moderate Trim</option>
                        <option value="3">3 - Heavy Trim</option>
                        <option value="4">4 - Removal</option>
                    </select>
                </div>
                <div class="button-group">
                    <button type="button" onclick="prevStep(6)">Back</button>
                    <button type="button" onclick="calculateEstimate()">Calculate</button>
                </div>
            </div>
        </form>
        <p id="result"></p>
        <button id="downloadButton" style="display:none;" onclick="downloadPDF()">Download PDF</button>
    </div>

    <script src="script.js"></script>
</body>
</html>